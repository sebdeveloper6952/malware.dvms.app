<script lang="ts">
	import type { NDKUserProfile } from '@nostr-dev-kit/ndk';
	import OutlinedButton from '../buttons/OutlinedButton.svelte';
	import { onMount, createEventDispatcher } from 'svelte';
	import type { NDKAppHandlerEvent } from '@lib/nostr/nip89';
	import LikeBar from '../LikeBar.svelte';

	interface ComponentEvent {
		selected: { pk: string };
	}

	export let event: NDKAppHandlerEvent;
	export let selected = false;

	let profile: NDKUserProfile | undefined;
	const dispatch = createEventDispatcher<ComponentEvent>();

	const content = JSON.parse(event.content);
	const image =
		content['picture'] ?? content['image'] ?? 'https://robohash.org/' + event.author.pubkey;
	const likesPercent = 0;

	onMount(async () => {
		profile = await event.fetchProfile();
	});

	const onUse = () => {
		dispatch('selected', {
			pk: event.author.pubkey
		});
	};
</script>

<div class="p-4 w-full bg-zinc-800 rounded-3xl">
	<div class="my-2 w-full h-fit flex justify-start items-center">
		<img src={image} alt="profile" class="mt-4 w-24 h-24 rounded-3xl" />
	</div>
	<div class="w-full">
		<div><p class="text-xl font-bold">{profile?.name}</p></div>
		<LikeBar {likesPercent} />
		<div class="mt-4"><p class="text-sm">{profile?.about}</p></div>
		<div class="mt-4 w-full flex justify-end">
			<OutlinedButton on:click={onUse}>{selected ? 'Remove' : 'Select'}</OutlinedButton>
		</div>
	</div>
</div>
