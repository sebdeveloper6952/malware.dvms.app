<script lang="ts">
	import dayjs from 'dayjs';
	import Icon from '@iconify/svelte';
	import { getPreview } from '@lib/helpers/linkPreview';
	import Accordion from '@lib/components/Accordion.svelte';
	import type { Nip90JobResultEvent } from '@lib/models/Nip90JobResult';
	import JobResultDetails from '../JobResultDetails.svelte';
	import { malwareScanningResultKind } from '@lib/nostr/kinds';

	export let event: Nip90JobResultEvent;
</script>

<div class="w-full bg-zinc-800 rounded-3xl">
	{#await event.init()}
		<p>loading...</p>
	{:then}
		<div class="p-4 w-full flex flex-col relative">
			<!-- dvm profile image and name -->
			<div class="flex justify-between">
				<div class="flex flex-col">
					<img src={event.author.profile?.image} alt="profile" class="w-16 h-16 rounded" />
					<p class="text-sm font-bold">{event.author.profile?.name}</p>
				</div>
			</div>

			<!-- job timestamp -->
			{#if event.created_at}
				<div class="flex items-center absolute top-2 right-2">
					<p class="text-gray-500 text-xs">{dayjs.unix(event.created_at).format('lll')}</p>
				</div>
			{/if}

			{#if event.kind === malwareScanningResultKind}
				<JobResultDetails {event} />
			{/if}
		</div>
	{/await}
</div>
