<script lang="ts">
	import { goto } from '$app/navigation';
	import { userStore, logout } from '@nostr/nsecSigner';
	import Icon from '@iconify/svelte';
	import OutlinedButton from '../buttons/OutlinedButton.svelte';
	import LoginModal from '../modals/LoginModal.svelte';

	let showDropdown = false;
	let showNsecModal = false;
	let sk = '';

	const onLogout = () => {
		logout();
		showDropdown = !showDropdown;
	};
</script>

<div class="p-2 flex items-center relative">
	<button on:click={() => goto('/')} class="flex gap-2">
		<Icon icon="pixelarticons:debug-check" width="24" height="24" />
		<p class="font-bold">Malware DVMs</p>
	</button>
	<div class="grow"></div>
	{#if $userStore}
		<button
			on:click={() => {
				showDropdown = !showDropdown;
			}}
		>
			{#if $userStore.profile?.image}
				<img
					src={$userStore.profile.image}
					alt="profile"
					class="w-10 h-10 p-px ring ring-orange-700 rounded-full"
				/>
			{:else}
				<img
					src={`https://robohash.org/${$userStore.pubkey}`}
					alt="profile"
					class="w-10 h-10 p-px ring ring-orange-700 rounded-full"
				/>
			{/if}
		</button>
	{:else}
		<OutlinedButton
			on:click={() => {
				showNsecModal = true;
			}}>Login</OutlinedButton
		>
	{/if}

	{#if showDropdown}
		<div class="flex flex-col bg-zinc-700 rounded-md absolute top-14 right-2 z-50">
			<button
				on:click={onLogout}
				class="py-1 px-12 flex gap-2 hover:bg-zinc-600 cursor-pointer rounded-md"
			>
				<p>Logout</p>
			</button>
		</div>
	{/if}

	<LoginModal show={showNsecModal} on:close={() => (showNsecModal = false)} />
</div>
