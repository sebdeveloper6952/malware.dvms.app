import { malwareScanningResultKind } from '@lib/nostr/kinds';
import NDK, { NDKEvent, NDKKind, type NostrEvent } from '@nostr-dev-kit/ndk';

export class Nip90JobFeedback extends NDKEvent {
	status: string = '';
	statusExtraInfo: string = '';
	amountMsat: number = 0;
	paymentRequest: string = '';

	constructor(ndk?: NDK, rawEvent?: NostrEvent) {
		super(ndk, rawEvent);

		rawEvent?.tags.forEach((tag) => {
			if (tag[0] === 'status') {
				this.status = tag[1] ?? '';
				this.statusExtraInfo = tag[2] ?? '';
			} else if (tag[0] === 'amount') {
				this.amountMsat = Number(tag[1] ?? 0);
				this.paymentRequest = tag[2] ?? '';
			}

			if (rawEvent.kind === malwareScanningResultKind) {
				this.status = 'result';
			}
		});
	}

	static from(ndkEvent: NDKEvent) {
		return new Nip90JobFeedback(ndkEvent.ndk, ndkEvent.rawEvent());
	}
}
