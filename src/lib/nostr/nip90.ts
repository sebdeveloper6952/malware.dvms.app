import { NDKEvent, NDKKind } from '@nostr-dev-kit/ndk';
import { ndk } from './ndk';
import { malwareScanningRequestKind } from './kinds';

export const publishJobRequestEvent = async (
	input: string,
	pks: string[],
	bidMsat: number
): Promise<NDKEvent> => {
	const e = new NDKEvent(ndk);
	e.kind = malwareScanningRequestKind;
	e.tags = [['i', input, 'url'], ['bid', bidMsat.toString()], ...pks.map((pk) => ['p', pk])];

	await e.publish();

	return e;
};

export const publishCustomerFeedbackEvent = async (
	content: string,
	feedback: string,
	jobResultEventId: string,
	dvmPubkey: string,
	resultKind: NDKKind
): Promise<NDKEvent> => {
	const e = new NDKEvent(ndk);
	e.kind = 7;
	e.content = content;
	e.tags = [
		['feedback', feedback],
		['e', jobResultEventId],
		['p', dvmPubkey],
		['k', resultKind.toString()]
	];
	await e.publish();

	return e;
};
