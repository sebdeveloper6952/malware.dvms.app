import NDKSvelte from '@nostr-dev-kit/ndk-svelte';
import { setNip07Signer, setSkSigner } from './nsecSigner';
import { persisted } from 'svelte-persisted-store';
import { get } from 'svelte/store';
import { NDKRelay } from '@nostr-dev-kit/ndk';

export const ndk = new NDKSvelte({
	explicitRelayUrls: [
		// 'wss://nostrue.com',
		'ws://localhost:4869'
	]
});

export const t = (url: string) => {
	ndk.pool.addRelay(new NDKRelay(url), true);
};

export const init = async () => {
	await ndk.connect();

	if (window.localStorage) {
		const pk = get(persisted('pk', ''));
		const sk = get(persisted('sk', ''));

		if (pk && pk !== '') {
			await setNip07Signer();
		} else if (sk && sk !== '') {
			await setSkSigner(sk);
		}
	}
};
