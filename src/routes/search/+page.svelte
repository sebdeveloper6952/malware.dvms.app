<script lang="ts">
	import JobResultCard from '@lib/components/cards/JobResultCard.svelte';
	import URLInputWithButton from '@lib/components/forms/URLInputWithButton.svelte';
	import type { Nip90JobResultEvent } from '@lib/models/Nip90JobResult';
	import { searchJobResults } from '@lib/stores/searchJobResults';
	import type { NDKEventStore } from '@nostr-dev-kit/ndk-svelte';
	import type { ComponentEvents } from 'svelte';

	let searchStore: NDKEventStore<Nip90JobResultEvent> | null;

	const onInputSubmit = (e: ComponentEvents<URLInputWithButton>['submit']) => {
		searchStore = searchJobResults(e.detail.value);
	};
</script>

<div class="w-full flex flex-col items-center">
	<div class="w-full md:max-w-screen-md flex flex-col gap-2">
		<div>
			<p>Search if a URL has been scanned:</p>
			<URLInputWithButton label="Search" on:submit={onInputSubmit} />
		</div>

		{#if $searchStore}
			{#each $searchStore as event}
				<JobResultCard {event} />
			{/each}
		{/if}
	</div>
</div>
